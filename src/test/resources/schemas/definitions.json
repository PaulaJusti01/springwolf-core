from flask import Flask, Response, request
from src.serving import start
from src.prediction import predict, generate_response

app = Flask(__name__)
model = start()

@app.route("/ping", methods=["GET"])
def ping():
    return Response(response="\n", status=200)

@app.route("/invocations", methods=["POST"])
def invocations():
    try:
        if "question" in request.get_json():
            response = generate_response(request, model)
        else:
            response = predict(request, model)
        return Response(response=response, status=200)
    except Exception as e:
        return Response(response=str(e), status=500)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)
