a
import json
from email_sender import send_email
from email_html import build_html_email

def lambda_handler(event, context):
    try:
        # Pega os dados do evento
        detail = event.get("detail", {})
        nome_modelo = detail.get("nome_modelo", "Nome Desconhecido")
        projeto = detail.get("projeto", "Projeto Desconhecido")
        status = detail.get("status", "Status não informado")
        destinatario = detail.get("destinatario", "destinatario@exemplo.com")

        # Gera título e HTML do e-mail
        titulo = f"Execução do modelo '{nome_modelo}' - {status.upper()}"
        corpo_html = build_html_email(nome_modelo, projeto, status)

        # Envia o e-mail
        send_email(
            destinatario=destinatario,
            assunto=titulo,
            html=corpo_html
        )

        return {
            "statusCode": 200,
            "body": json.dumps("Email enviado com sucesso.")
        }
    except Exception as e:
        return {
            "statusCode": 500,
            "body": json.dumps(f"Erro ao enviar e-mail: {str(e)}")
        }
